import pandas as pd
import json

from autodnd.utils.project_root import get_project_root
from autodnd.utils.ruleset_enum import RuleSet

# folder where you want the jsons to reside
data_folder = get_project_root() / "data" / "jsonrules"

# folder to save the content
save_folder = get_project_root() / "data" / "processed"

# column names from the original allignments json file
index_col_str = "index"
url_col_str = "url"
desc_col_str = "desc"

# switch to add a manually performed re-write of the rule sections
add_rewrite = True

# These are my manual rewrite of the rule section content. Its rewritten for easier LLM readability.
rewrite_content = {
    "/api/2014/rule-sections/the-order-of-combat": "Step 1: **Determine Surprise**\n\n- Decide if any combatants are surprised.\n- Compare Dexterity (Stealth) checks of hiding creatures with the passive Wisdom (Perception) scores of opposing creatures.\n- Note that surprised creatures can't take actions or move on their first turn and can't react until after their first turn ends.\n\nStep 2: **Establish Positions**\n\n- Decide where all characters and monsters are located based on marching orders or positions in the area.\n\nStep 3: **Roll Initiative**\n\n- Each participant rolls a Dexterity check for initiative.\n- Rank them from highest to lowest roll to establish the initiative order.\n- For identical creatures, make one roll for the entire group.\n- Resolve ties by allowing players to decide among their characters, or roll a d20 if needed.\n\nStep 4: **Take Turns**\n\n- Each participant acts in the order established by the initiative.\n- On their turn, a participant can:\n  - Move up to their speed.\n  - Take one action.\n  - Take one bonus action if available.\n  - Interact with one object for free.\n- Encourage players to consider taking the Dodge or Ready action if unsure.\n\nStep 5: **Reactions**\n\n- Participants may take one reaction per round in response to a trigger.\n- Reactions do not reset until the start of the participant's next turn.\n\nStep 6: **Begin the Next Round**\n\n- After all participants have taken their turns, start a new round.\n- Repeat Step 4 until one side is defeated or combat ends.",
    "/api/2014/rule-sections/movement-and-position": "### Movement and Position Instructions for DnD 5e\n\n1. **Movement Basics**\n   - On your turn, move up to your speed.\n   - Move as much or as little as desired on your turn.\n   - Movement can include walking, jumping, climbing, and swimming.\n\n2. **Breaking Up Movement**\n   - Divide your movement before, during, or after actions.\n   - Example: With 30 feet speed, move 10 feet, act, then move 20 feet.\n\n3. **Moving Between Attacks**\n   - If you have multiple attacks, move between them.\n   - Example: With speed 25 and two attacks, move 10 feet, attack, move 15 feet, attack again.\n\n4. **Using Different Speeds**\n   - Switch between speeds (e.g., walking and flying) during your move.\n   - Subtract distance already moved from the new speed.\n\n5. **Difficult Terrain**\n   - Costs 1 extra foot for each foot moved.\n   - Includes obstacles like rubble, undergrowth, or another creature's space.\n\n6. **Being Prone**\n   - Drop prone without using movement.\n   - Standing up costs half your speed.\n   - Crawl uses additional movement (1 foot costs 2 feet).\n\n7. **Moving Around Creatures**\n   - Move through nonhostile creature spaces.\n   - Move through hostile creature spaces only if they are two sizes larger or smaller.\n   - Do not end your move in another creature's space.\n\n8. **Opportunity Attacks**\n   - Leaving a hostile creature's reach provokes an opportunity attack.\n\n9. **Flying Movement**\n   - If flying and knocked prone or speed reduced to 0, the creature falls unless it can hover or is supported by magic.\n\n10. **Creature Size and Space**\n    - Refer to the size categories to understand space control in combat.\n\n11. **Squeezing Space**\n    - Move through spaces fit for a creature one size smaller.\n    - Costs 1 extra foot of movement and imposes disadvantages.\n\n12. **Interacting with Objects**\n    - Perform simple interactions during movement or actions, like opening doors or drawing a sword.",
    "/api/2014/rule-sections/actions-in-combat": "### Actions in Combat - Step-by-Step\n\n1. **Choose an Action for Your Turn**\n\n   - Options include a basic action, a class feature, a special action, or an improvised action.\n   - For improvised actions, ask the GM if it's possible and what roll is needed.\n\n2. **Possible Actions to Take**\n\n   - **Attack**\n     - Make a melee or ranged attack.\n     - Use features like Extra Attack if available.\n\n   - **Cast a Spell**\n     - Check the spell's casting time.\n     - Use your action if the spell requires 1 action to cast.\n\n   - **Dash**\n     - Double your movement for this turn.\n     - Adjust for speed changes (e.g., speed of 30 feet allows 60 feet of movement when dashing).\n\n   - **Disengage**\n     - Move without provoking opportunity attacks for the rest of this turn.\n\n   - **Dodge**\n     - Give attackers disadvantage on attacks against you until your next turn, if you can see them.\n     - Make Dexterity saving throws with advantage.\n     - Lose this if incapacitated or speed drops to 0.\n\n   - **Help**\n     - Aid an ally with a task for advantage on their ability check until your next turn.\n     - Aid an ally's attack by being within 5 feet of the target, giving them advantage on their first attack before your next turn.\n\n   - **Hide**\n     - Make a Dexterity (Stealth) check to hide.\n     - Gain benefits if successful.\n\n   - **Ready**\n     - Choose a trigger that will allow you to act using a reaction before your next turn.\n     - Specify the action or movement to take when the trigger happens.\n     - Ready a spell with 1 action casting time if you wish, but it requires concentration.\n\n   - **Search**\n     - Concentrate on finding something.\n     - Make a Wisdom (Perception) check or an Intelligence (Investigation) check.\n\n   - **Use an Object**\n     - Interact with an object requiring your action.\n     - Useful for interacting with more than one object per turn.",
    "/api/2014/rule-sections/making-an-attack": "### Making an Attack\n\n1. **Choose a Target**\n   - Pick a target within your attack range: creature, object, or location.\n\n2. **Determine Modifiers**\n   - Check if the target has cover.\n   - Determine if you have advantage or disadvantage.\n   - Apply any spells, abilities, or effects as bonuses or penalties.\n\n3. **Resolve the Attack**\n   - Roll a d20 for an attack roll.\n   - Add appropriate modifiers (ability and proficiency).\n   - If roll plus modifiers meets/exceeds target's AC, it hits.\n   - On a hit, roll damage unless specified otherwise.\n\n### Attack Rolls\n\n- **Modifiers**\n  - **Ability Modifier**: Use Strength for melee or Dexterity for ranged. Spells use the caster's ability modifier.\n  - **Proficiency Bonus**: Add this if proficient with the weapon or spell.\n\n- **Critical Hits**\n  - Roll a 20: automatic hit, may have extra effects.\n  - Roll a 1: automatic miss.\n\n### Unseen Attackers and Targets\n\n- **If You Can't See Target**\n  - Disadvantage on attack roll.\n  - Miss if target isn't in the guessed location.\n\n- **If Target Can't See You**\n  - Advantage on attack rolls.\n  - Reveal location if attack hits or misses.\n\n### Ranged Attacks\n\n- **Range**\n  - Must target within range.\n  - Two ranges: normal and long (disadvantage in long range).\n\n- **Close Combat**\n  - Disadvantage if within 5 feet of a hostile creature.\n\n### Melee Attacks\n\n- **Reach**\n  - Attack targets within your reach, usually 5 feet.\n  - Larger creatures may have more reach.\n\n- **Unarmed Strike**\n  - Uses Strength modifier, deals 1 + Strength damage.\n\n### Opportunity Attacks\n\n1. **When Triggered**\n   - Occurs when an enemy moves out of your reach.\n\n2. **Making the Attack**\n   - Use a reaction to make a melee attack.\n\n3. **Avoiding It**\n   - Use Disengage action.\n   - No opportunity attack if moved by something else (e.g., explosion).\n\n### Two-Weapon Fighting\n\n1. **Attack with Two Weapons**\n   - Attack with a light melee weapon in each hand.\n   - Use bonus action for second attack, no ability modifier for damage unless negative.\n\n2. **Thrown Property**\n   - Can throw instead of melee attack if weapon allows.\n\n### Contests in Combat\n\n#### Grappling\n\n1. **Initiating a Grapple**\n   - Use Attack action for a grapple.\n   - Opponent must be within reach and not more than one size larger.\n\n2. **Grapple Check**\n   - Make a Strength (Athletics) check.\n   - Opponent contests with Strength (Athletics) or Dexterity (Acrobatics).\n\n3. **Escaping**\n   - Grappled creature uses action to contest and escape.\n\n#### Shoving a Creature\n\n1. **Making a Shove**\n   - Use Attack action.\n   - Opponent must be within reach and not more than one size larger.\n\n2. **Shove Check**\n   - Make a Strength (Athletics) check.\n   - Opponent contests with Strength (Athletics) or Dexterity (Acrobatics).\n\n3. **Result**\n   - On success, knock prone or push 5 feet.",
    "/api/2014/rule-sections/cover": "### Step-by-Step Instructions for Cover\n\n1. **Identify Cover:**\n   - Look for walls, trees, creatures, or objects.\n   - Determine if they can block attacks.\n\n2. **Determine Attack Origin:**\n   - Ensure attacks originate from the opposite side of the cover.\n\n3. **Assess the Highest Degree of Cover:**\n   - If a target is behind multiple covers, identify which provides the most protection.\n\n4. **Understand Cover Types:**\n   - **Half Cover:**\n     - Provides +2 bonus to AC and Dexterity saving throws.\n     - Obstacle blocks at least half the body.\n     - Examples: low wall, large furniture, narrow tree, creature.\n   - **Three-Quarters Cover:**\n     - Provides +5 bonus to AC and Dexterity saving throws.\n     - About three-quarters of the body is covered.\n     - Examples: portcullis, arrow slit, thick tree.\n   - **Total Cover:**\n     - Target can't be directly attacked.\n     - Complete concealment behind an obstacle.\n     - Some spells may still affect via area effects.\n\n5. **Apply Bonuses:**\n   - Apply the appropriate bonus to AC and Dexterity saving throws based on cover type.",
    "/api/2014/rule-sections/damage-and-healing": "# Damage and Healing Instructions\n\n## Hit Points\n1. Track each creature's hit points from maximum down to 0.\n2. Subtract damage from a creature's current hit points.\n3. No effect occurs until hit points reach 0.\n\n## Damage Rolls\n1. Roll damage dice and add modifiers from weapons, spells, or abilities.\n2. Apply total damage to the target's hit points.\n3. For multiple targets, roll damage once for all.\n\n## Critical Hits\n1. Roll all damage dice twice for critical hits.\n2. Add relevant modifiers to the total.\n3. Roll all damage dice together to speed up play.\n\n## Damage Types\n1. Determine the type of damage (e.g., acid, bludgeoning).\n2. Assign damage type when new effects occur.\n\n## Damage Resistance and Vulnerability\n1. Halve damage if a creature has resistance.\n2. Double damage if a creature has vulnerability.\n3. Apply resistance and vulnerability after other modifiers.\n\n## Healing\n1. Add healing received to current hit points without exceeding the maximum.\n2. Use magic to restore a dead creature to life before healing.\n   \n## Dropping to 0 Hit Points\n### Instant Death\n1. Check if remaining damage equals or exceeds the hit point maximum for instant death.\n\n### Falling Unconscious\n1. Become unconscious if not killed by damage.\n2. Regain any hit points to end unconsciousness.\n\n### Death Saving Throws\n1. Roll a d20; 10 or higher succeeds, below 10 fails.\n2. Track three successes or failures for stabilization or death.\n3. Rolling a 1 counts as two failures; a 20 restores 1 hit point.\n\n### Stabilizing a Creature\n1. Use an action for DC 10 Wisdom (Medicine) check to stabilize.\n2. Stable creatures don't roll death saves but remain unconscious.\n3. Regain 1 hit point after 1d4 hours if not healed.\n\n### Monsters and Death\n1. Monsters usually die at 0 hit points unless specified otherwise.\n\n## Knocking a Creature Out\n1. Choose to knock out instead of dealing a killing blow with melee.\n2. The creature falls unconscious and stable.\n\n## Temporary Hit Points\n1. Use temporary hit points to absorb damage first.\n2. Temporary hit points don't exceed maximum but can coexist.\n3. Choose whether to keep current or new temporary hit points.\n4. Temporary hit points don't restore consciousness or stabilize from 0 hit points.\n5. They last until depleted or after a long rest unless specified otherwise.",
    "/api/2014/rule-sections/mounted-combat": "## Mounted Combat Instructions for a Rookie DM\n\n### Mounting and Dismounting\n\n1. **Identify a Mount:**\n   - Ensure the creature is willing and at least one size larger than the player.\n   \n2. **Mounting:**\n   - The player can mount or dismount a creature within 5 feet during their move.\n\n3. **Movement Cost:**\n   - Mounting or dismounting costs half the player's movement speed.\n   - Example: If speed is 30 feet, it takes 15 feet of movement.\n\n4. **Movement Restrictions:**\n   - Player cannot mount if movement remaining is less than required cost or if speed is 0.\n\n5. **Falling Off:**\n   - If the mount involuntarily moves, the rider must make a DC 10 Dexterity saving throw.\n   - Failure results in the player falling off and landing prone within 5 feet.\n\n6. **If Knocked Prone:**\n   - If the player is knocked prone while mounted, make a DC 10 Dexterity saving throw.\n\n7. **Mount Knocked Prone:**\n   - Use a reaction to dismount and land on feet, or fall prone within 5 feet.\n\n### Controlling a Mount\n\n1. **Control Options:**\n   - Players can control mounts or allow them to act independently.\n\n2. **Controlled Mount:**\n   - Only applicable if the mount is trained to accept a rider.\n   - Initiative matches the player's.\n   - Actions allowed: Dash, Disengage, Dodge.\n   - Can move and act the same turn as mounting.\n\n3. **Independent Mount:**\n   - Retains its initiative order.\n   - Acts freely and may not follow player's commands.\n\n4. **Opportunity Attacks:**\n   - If an opportunity attack is provoked, the attacker may target the player or the mount.",
    "/api/2014/rule-sections/underwater-combat": "### Underwater Combat: Step-by-Step Instructions for Combat\n\n1. **Melee Weapon Attacks:**\n   - Determine if the attacking creature has a swimming speed.\n   - If the creature does not have a swimming speed:\n     - Apply disadvantage on the attack roll unless using a dagger, javelin, shortsword, spear, or trident.\n\n2. **Ranged Weapon Attacks:**\n   - Check if the target is beyond the weapon's normal range.\n     - If yes, the attack automatically misses.\n     - If no, continue to the next step.\n   - Apply disadvantage on the attack roll unless using:\n     - A crossbow.\n     - A net.\n     - A thrown weapon like a javelin, spear, trident, or dart.\n\n3. **Fire Damage:**\n   - Any creature or object fully immersed in water has resistance to fire damage.",
    "/api/2014/rule-sections/ability-scores-and-modifiers": "### Step-by-Step Instructions: Determining Ability Modifiers\n\n1. **Identify Ability Score:**\n   - Determine the character's ability score.\n\n2. **Subtract 10:**\n   - Subtract 10 from the ability score.\n\n3. **Divide by 2:**\n   - Take the result from step 2 and divide it by 2.\n\n4. **Round Down:**\n   - Round the result from step 3 down to the nearest whole number. This is the ability modifier.\n\n5. **Use in Gameplay:**\n   - Apply this modifier to attack rolls, ability checks, and saving throws.\n\n6. **Reference Table (Optional):**\n   - If needed, use the provided table to verify results or quickly find common modifiers.\n\nThat’s it! Use these steps to integrate ability modifiers into your game easily.",
    "/api/2014/rule-sections/advantage-and-disadvantage": "### Advantage and Disadvantage: Step-by-Step Instructions\n\n1. **Identify Advantage or Disadvantage:**\n   - Determine if a special ability, spell, or game circumstance grants advantage or imposes disadvantage.\n\n2. **Roll the Dice:**\n   - Roll a d20 along with a second d20.\n\n3. **Evaluate Rolls:**\n   - If you have advantage, use the higher roll.\n   - If you have disadvantage, use the lower roll.\n\n4. **Multiple Situations:**\n   - Regardless of multiple advantages or disadvantages, roll only one additional d20.\n\n5. **Simultaneous Advantage and Disadvantage:**\n   - If both apply, they cancel each other out. Roll only one d20.\n\n6. **Rerolling with Traits:**\n   - If using a trait like Lucky, choose and reroll one of the initial dice.\n\n7. **Gaining Advantage or Disadvantage:**\n   - Acquired through abilities, actions, spells, or GM decision.\n\n8. **GM Influence:**\n   - The GM can determine if circumstances grant advantage or disadvantage.",
    "/api/2014/rule-sections/proficiency-bonus": "1. Determine the proficiency bonus based on the character's level.\n\n2. Use the proficiency bonus for:\n   - Ability checks\n   - Saving throws\n   - Attack rolls\n\n3. Do not add the proficiency bonus to a single roll more than once.\n\n4. If two rules say to add the bonus to the same roll, apply it only once.\n\n5. Double or halve the proficiency bonus only if a feature specifically says so.\n\n6. When doubling or halving, apply it only once per roll.\n\n7. If a feature suggests multiplying the bonus on non-proficient checks, the bonus is 0.\n\n8. Do not normally multiply the bonus for attack rolls or saving throws.\n\n9. If a feature allows multiplying for attack or saving throws, apply the same rules as above.",
    "/api/2014/rule-sections/ability-checks": "### Ability Checks\n\n1. **Identify the Challenge**\n   - Determine when a character or monster faces a non-attack challenge.\n\n2. **Choose the Ability**\n   - Select one of the six abilities relevant to the task.\n\n3. **Determine Difficulty**\n   - Set a Difficulty Class (DC) using the Typical Difficulty Classes table:\n     - Very easy: 5\n     - Easy: 10\n     - Medium: 15\n     - Hard: 20\n     - Very hard: 25\n     - Nearly impossible: 30\n\n4. **Make the Check**\n   - Roll a d20.\n   - Add the relevant ability modifier.\n   - Include any bonuses or penalties.\n   - Compare the total to the DC.\n   - Success: Total meets/exceeds DC.\n   - Failure: Total is below DC.\n\n### Contests\n\n1. **Determine the Contest**\n   - Identify when two characters/monsters are opposing each other.\n\n2. **Conduct Ability Checks**\n   - Each participant makes an appropriate ability check.\n   - Add bonuses/penalties to each roll.\n\n3. **Compare Results**\n   - Highest total wins.\n   - In a tie, situation remains unchanged.\n\n### Skills\n\n1. **Identify Relevant Skill**\n   - Determine if a specific skill applies to the check.\n\n2. **Skill Proficiency**\n   - Add proficiency bonus if character is proficient.\n\n3. **Variant Skill Use**\n   - Consider unusual combinations of abilities and skills when reasonable.\n\n### Passive Checks\n\n1. **Calculate Passive Score**\n   - Use: 10 + relevant modifiers.\n   - Advantage: Add 5.\n   - Disadvantage: Subtract 5.\n\n2. **Application**\n   - Use for repeated tasks or secret checks.\n\n### Working Together\n\n1. **Helping**\n   - Lead character makes check with advantage if help is applicable.\n\n2. **Group Checks**\n   - Everyone rolls the same ability check.\n   - If half succeed, the group succeeds. Otherwise, group fails.",
    "/api/2014/rule-sections/using-each-ability": "## Ability Guidelines\n\n### Strength\n\n1. Use Strength to measure power and force.\n2. Make a Strength check to:\n   - Lift, push, pull, or break objects.\n   - Force through spaces using brute force.\n3. Athletics covers:\n   - Climbing, jumping, or swimming challenges.\n4. GM may use Strength checks for:\n   - Opening doors.\n   - Breaking bonds.\n   - Pushing through tunnels.\n   - Hang onto or tip objects.\n\n#### Attack Rolls and Damage\n\n1. Add your Strength modifier for melee weapon attacks and damage.\n\n#### Lifting and Carrying\n\n1. Carrying capacity = Strength score x 15 pounds.\n2. Push/drag/lift = Up to twice carrying capacity (Strength score x 30). Speed drops to 5 feet if over capacity.\n\n#### Size Adjustments\n\n1. Larger creatures can carry more; adjust carrying capacity accordingly.\n\n#### Encumbrance Variant\n\n1. Encumbered if carrying more than 5x Strength. Speed drops by 10 feet.\n2. Heavily encumbered if over 10x Strength. Speed drops by 20 feet, disadvantage on related checks.\n\n### Dexterity\n\n1. Use Dexterity to measure agility and balance.\n2. Make a Dexterity check to:\n   - Move nimbly or quietly.\n3. Acrobatics covers:\n   - Staying upright, performing stunts.\n4. Sleight of Hand covers:\n   - Acts of manual trickery.\n5. Stealth covers:\n   - Concealing yourself.\n\n#### Attack Rolls and Damage\n\n1. Add Dexterity modifier for ranged weapon attacks and finesse melee weapons.\n\n#### Armor Class\n\n1. Add Dexterity modifier to Armor Class based on armor.\n\n#### Initiative\n\n1. Roll initiative with a Dexterity check.\n\n#### Hiding\n\n1. Make a Dexterity (Stealth) check to hide.\n2. Compare to opponents’ Wisdom (Perception) checks or Passive Perception.\n\n### Constitution\n\n1. Use Constitution to measure stamina and health.\n2. Make a Constitution check to:\n   - Endure extreme conditions.\n\n#### Hit Points\n\n1. Add Constitution modifier to each Hit Die for hit points.\n\n### Intelligence\n\n1. Use Intelligence for logic and memory tasks.\n2. Make an Intelligence check for:\n   - Recalling information or deducing facts.\n\n#### Spellcasting\n\n1. Wizards use Intelligence for spellcasting and saving throws.\n\n### Wisdom\n\n1. Use Wisdom for perception and intuition.\n2. Make a Wisdom check for:\n   - Reading body language, understanding environments.\n\n#### Spellcasting\n\n1. Clerics, druids, and rangers use Wisdom for spellcasting and saving throws.\n\n### Charisma\n\n1. Use Charisma for interaction and influence.\n2. Make a Charisma check for:\n   - Social interactions or convincing others.\n\n#### Spellcasting\n\n1. Bards, paladins, sorcerers, and warlocks use Charisma for spellcasting and saving throws.",
    "/api/2014/rule-sections/saving-throws": "### Step-by-Step Instructions for Saving Throws\n\n1. **Identify the Trigger**  \n   Recognize when a saving throw is required (e.g., spell, trap, poison, etc.).\n\n2. **Determine the Type of Save**  \n   Know which ability modifier to use based on the threat:  \n   - Dexterity modifier for Dexterity saves, etc.\n\n3. **Roll the Dice**  \n   Roll a d20.\n\n4. **Add Modifiers**  \n   Add the appropriate ability modifier to your roll.\n\n5. **Apply Proficiency (if applicable)**  \n   - Check if the character has proficiency in that saving throw type.\n   - If proficient, add the proficiency bonus.\n\n6. **Consider Situational Factors**  \n   - Apply any situational bonuses or penalties.\n   - Check for advantage or disadvantage and roll accordingly.\n\n7. **Determine the DC**  \n   - Find out the Difficulty Class (DC) set by the effect causing the save.\n\n8. **Compare Roll to DC**  \n   - Compare your final result to the DC.\n\n9. **Resolve the Outcome**  \n   - If your result meets or exceeds the DC, the save is successful.\n   - If not, the save is failed.\n   - Follow the specific effect’s rules on what happens next (e.g., no harm, reduced harm).\n\n10. **Narrate the Result**  \n    Describe the outcome to your players in the context of the game world.",
    "/api/2014/rule-sections/time": "### Dungeon Environment\n\n1. **Movement**: \n   - Assign about 1 minute to move through a long hallway.\n   - Assign about 1 minute to check for traps on a door.\n   - Assign about 10 minutes to search a chamber.\n\n### City or Wilderness\n\n2. **Short Journeys**: Use hours.\n   - Example: Cover 15 miles in around 4 hours.\n\n### Long Journeys\n\n3. **Extended Travel**: Use days.\n   - Example: Travel for 4 days with potential interruptions (like a goblin ambush).\n\n### Combat and Fast-Paced Situations\n\n4. **Rounds**: \n   - Each round lasts 6 seconds.",
    "/api/2014/rule-sections/movement": "### Movement: Step-by-Step Instructions\n\n#### General Movement\n1. Describe journey succinctly without exact distances/time if not critical.\n2. Mention key points or goals during the movement (e.g., reaching a dungeon).\n\n#### Calculating Travel Time\n1. Determine if exact travel time is needed (days, hours, minutes).\n2. Identify speed and travel pace of group (Normal, Fast, Slow).\n\n#### Speed\n1. Check character/monster speed (distance in feet per round).\n2. Use this to calculate movement per minute, hour, day.\n\n#### Travel Pace\n1. Choose travel pace:\n   - **Fast Pace:** 400ft/minute, 4 miles/hour, 30 miles/day. (-5 Perception penalty)\n   - **Normal Pace:** 300ft/minute, 3 miles/hour, 24 miles/day.\n   - **Slow Pace:** 200ft/minute, 2 miles/hour, 18 miles/day. (Use Stealth)\n\n2. **Forced March:** Travel beyond 8 hours risks exhaustion:\n   - Each additional hour: Make Constitution save (DC 10 + 1 for each hour over).\n   - Fail = 1 exhaustion level.\n\n3. **Mounts/Vehicles:** Consider pace/speed specific to mounts, vehicles, ships:\n   - Mounted: Can gallop for an hour, covers twice fast pace.\n   - Land vehicle: Choose pace.\n   - Watercraft: Limited by vessel speed, no fast/slow effects.\n\n#### Difficult Terrain\n1. Movement in difficult terrain costs double.\n2. Apply terrain penalty to all paces.\n\n#### Special Types of Movement\n\n##### Climbing, Swimming, Crawling\n1. Costs 1 extra foot per foot moved (2 extra in difficult terrain).\n2. Checks may be required for challenging surfaces/conditions (Strength Athletics).\n\n##### Jumping\n\n**Long Jump**\n1. Run up 10ft, jump distance = Strength score.\n2. Standing jump = half distance.\n3. Terrain hits/wall jumps may require DC 10 Strength Athletics check.\n4. Difficult terrain landings need DC 10 Dexterity Acrobatics check.\n\n**High Jump**\n1. Run up 10ft, leap = 3 + Strength modifier feet.\n2. Standing jump = half distance.\n3. Arms extend jump height + 1.5x character height.",
    "/api/2014/rule-sections/the-environment": "### Environment Instructions for Dungeon Masters\n\n#### Falling\n\n1. Determine the height of the fall.\n2. Calculate the damage: 1d6 bludgeoning damage for every 10 feet fallen.\n3. Maximum damage is capped at 20d6.\n4. The creature lands prone unless damage is avoided.\n\n#### Suffocating\n\n1. Determine how long a creature can hold its breath: 1 minute + Constitution modifier (minimum 30 seconds).\n2. If the creature runs out of breath, they have rounds equal to Constitution modifier (minimum 1) before dropping to 0 hit points.\n3. At the start of the next turn, the creature drops to 0 hit points and cannot regain points until breathing resumes.\n\n#### Vision and Light\n\n1. Determine area visibility:\n   - Lightly obscured: Disadvantage on sight-based Wisdom (Perception) checks.\n   - Heavily obscured: Creature is effectively blinded.\n\n2. Identify light levels:\n   - Bright light: Normal vision.\n   - Dim light: Lightly obscured.\n   - Darkness: Heavily obscured.\n\n3. Note special abilities:\n   - Blindsight: Perceive without sight within specific radius.\n   - Darkvision: See darkness as dim light; cannot discern colors.\n   - Truesight: See in darkness and magical darkness; detect illusions, see into Ethereal Plane.\n\n#### Food and Water\n\n- **Food Needs:**\n  1. 1 pound per day needed.\n  2. Half rations extend food, but count as half a day without food.\n  3. Days without food: 3 + Constitution modifier (minimum 1).\n  4. Post-limit: 1 level of exhaustion per extra day.\n\n- **Water Needs:**\n  1. 1 gallon per day (2 gallons in hot weather).\n  2. Half-water: DC 15 Constitution save or suffer exhaustion.\n  3. Less than half: Automatic exhaustion level.\n  4. If exhausted, suffer 2 levels.\n\n#### Interacting with Objects\n\n1. Describe player actions involving objects (e.g., pulling levers).\n2. If action requires effort, call for a Strength check.\n3. Set DC based on task difficulty.\n4. Objects can be damaged by weapons and spells (immune to poison and psychic damage).\n5. Determine object’s Armor Class and hit points.\n6. Objects fail Strength and Dexterity saves.\n7. Break object if it drops to 0 hit points.\n8. Attempt Strength check to break object; set DC.",
    "/api/2014/rule-sections/resting": "### Short Rest Instructions\n\n1. **Duration**: Ensure at least 1 hour of downtime.\n2. **Activity**: Only allow activities such as eating, drinking, reading, and tending wounds.\n3. **Hit Dice Use**:\n   - At the end of the rest, players can use Hit Dice.\n   - Maximum number equals the character’s level.\n   - Roll each die, add Constitution modifier, regain hit points.\n   - Decide to use additional Hit Dice after each roll if desired.\n\n### Long Rest Instructions\n\n1. **Duration**: Ensure at least 8 hours of downtime.\n2. **Activity**: Allow sleeping or light activities such as reading, talking, eating, or standing watch (max 2 hours).\n3. **Interruption**:\n   - Avoid strenuous activity (e.g., walking, fighting) for more than 1 hour.\n   - If interrupted, restart the rest to gain benefits.\n4. **Recovery**:\n   - Regain all lost hit points.\n   - Regain spent Hit Dice up to half the total number (minimum of one).\n5. **Limitations**:\n   - Only one long rest benefits can be gained in a 24-hour period.\n   - Ensure the character has at least 1 hit point at the start.",
    "/api/2014/rule-sections/between-adventures": "### Managing Time Between Adventures\n\n1. **Determine Time Passing:**\n   - Decide how much time will pass between adventures.\n   - Choose descriptive details about your character’s activities during this time.\n\n2. **Lifestyle Expenses:**\n   - Choose your character’s lifestyle quality (e.g., modest, comfortable).\n   - Pay the daily cost associated with that lifestyle.\n   - Remember, lifestyle affects social interactions but doesn’t significantly alter gameplay.\n\n3. **Choose Downtime Activities:**\n   - Discuss desired activities with the GM.\n   - Ensure activities are suitable for the available downtime.\n   - Dedicate at least 8 hours per day to the chosen activity.\n\n### Downtime Activities\n\n#### Crafting\n1. **Crafting Items:**\n   - Verify proficiency with necessary tools.\n   - Ensure access to required materials and locations.\n   - Calculate item’s total market value and start crafting in 5-gp increments.\n   - Pay half the market value in raw materials.\n   - Multiple players can collaborate, each contributing 5 gp worth of effort per day.\n\n2. **Living While Crafting:**\n   - Maintain a modest lifestyle for free, or a comfortable lifestyle at half cost.\n\n#### Practicing a Profession\n1. **Work Between Adventures:**\n   - Engage in a profession to support a modest lifestyle free of charge.\n\n2. **Support from Organizations:**\n   - If employed by an organization, maintain a comfortable lifestyle.\n   - Use Performance skill to achieve a wealthy lifestyle.\n\n#### Recuperating\n1. **Recovery Process:**\n   - Spend three days recuperating.\n   - Make a DC 15 Constitution saving throw after three days.\n   - Success provides one of the following:\n     - End an effect preventing hit point recovery.\n     - Gain advantage on saves vs. disease/poison for 24 hours.\n\n#### Researching\n1. **Begin Research:**\n   - Confirm the availability of information with the GM.\n   - Determine necessary days and any restrictions.\n   - Possibly perform ability checks (e.g., Intelligence, Charisma).\n\n2. **Cost of Research:**\n   - Pay 1 gp per research day, plus lifestyle costs.\n\n#### Training\n1. **Learn a Language or Tool:**\n   - Find a suitable instructor.\n   - GM determines the duration and any required checks.\n   - Train for 250 days at 1 gp per day.\n   - Acquire new language/tool proficiency upon completion.",
    "/api/2014/rule-sections/what-is-a-spell": "1. **Understanding Spells:**\n   - Spells are magical effects created by manipulating magical energies.\n\n2. **Spell Levels:**\n   - Spells have levels from 0 to 9.\n   - Higher-level spells require more powerful casters.\n\n3. **Known and Prepared Spells:**\n   - Casters must know or prepare spells to use them.\n   - The number of spells you can have ready depends on your character level.\n\n4. **Spell Slots:**\n   - You can only cast a limited number of spells before resting.\n   - Each spell uses a spell slot of its level or higher.\n   - Resting restores used spell slots.\n\n5. **Casting Spells at Higher Levels:**\n   - You can cast a spell using a higher-level slot, enhancing its power.\n   - Check spell descriptions for effects when cast at higher levels.\n\n6. **Casting in Armor:**\n   - You need armor proficiency to cast spells in armor.\n\n7. **Cantrips:**\n   - Cantrips are level 0 spells that don't use spell slots and can be cast repeatedly.\n\n8. **Ritual Casting:**\n   - Some spells can be cast as rituals, taking 10 extra minutes and not using a spell slot.\n   - You need a feature that allows ritual casting to do so.",
    "/api/2014/rule-sections/casting-a-spell": "## Steps for Casting a Spell\n\n### General Steps\n1. **Identify the Spell:** Find the spell's name, level, school, casting time, range, components, and duration.\n2. **Understand the Spell Effect:** Read through the effects described in the spell.\n\n### Casting Time\n3. **Check Casting Time:** Identify whether it requires an action, bonus action, reaction, or longer.\n\n- **Action:** Use one action during your turn.\n- **Bonus Action:** Use a bonus action during your turn, ensuring no other bonus action has been taken. You may cast a cantrip with a casting time of 1 action this turn.\n- **Reaction:** Follow specific trigger conditions described in the spell.\n- **Longer Times:** Spend actions and maintain concentration each turn until complete.\n\n### Spell Range\n4. **Determine Range:** Identify if the spell targets a creature, object, or point in space within the specified range.\n\n### Components\n5. **Verify Components:** Ensure availability of verbal (V), somatic (S), or material (M) components.\n   - **Verbal (V):** Chant specific mystic words.\n   - **Somatic (S):** Use one free hand for gestures.\n   - **Material (M):** Use specified items, a component pouch, or a spellcasting focus. If material is consumed, ensure availability for each casting.\n\n### Duration\n6. **Check Duration:** Note how long the spell lasts and if it requires concentration.\n\n- **Concentration:** Maintain focus without interruption. If broken, spell ends. Do not cast another concentration spell, avoid incapacitation, and succeed on Constitution saving throws if damaged.\n\n### Targets\n7. **Select Targets:** Choose legal targets within line of sight, ensuring no total cover.\n\n### Areas of Effect\n8. **Area Selection:** Determine shape (cone, cube, cylinder, line, sphere) and point of origin per spell description. Ensure no obstructions block the area.\n\n### Spell Saving Throws\n9. **Notify Targets:** Inform them of any saving throws to avoid effects. Calculate DC: 8 + spellcasting ability modifier + proficiency bonus + any special modifiers.\n\n### Spell Attack Rolls\n10. **Make Attack Roll:** Calculate attack bonus: spellcasting ability modifier + proficiency bonus. Consider disadvantage if within 5 feet of a hostile creature.\n\n### Combining Effects\n11. **Combine Effects:** Overlapping different spells add effects. Repeated castings of the same spell do not stack.\n\n### Schools of Magic\n12. **Identify School:** Refer to the spell’s school (e.g., Abjuration, Conjuration) for thematic insight, but note it has no additional rules.",
    "/api/2014/rule-sections/standard-exchange-rates": "### Standard Exchange Rates Instructions\n\n1. **Understand the Coin Types:**\n   - Copper (cp)\n   - Silver (sp)\n   - Electrum (ep)\n   - Gold (gp)\n   - Platinum (pp)\n\n2. **Convert Between Coins:**\n\n   - **Copper to Other Coins:**\n     - 10 Copper = 1 Silver\n     - 50 Copper = 1 Electrum\n     - 100 Copper = 1 Gold\n     - 1,000 Copper = 1 Platinum\n\n   - **Silver to Other Coins:**\n     - 1 Silver = 10 Copper\n     - 5 Silver = 1 Electrum\n     - 10 Silver = 1 Gold\n     - 100 Silver = 1 Platinum\n\n   - **Electrum to Other Coins:**\n     - 1 Electrum = 50 Copper\n     - 1 Electrum = 5 Silver\n     - 2 Electrum = 1 Gold\n     - 20 Electrum = 1 Platinum\n\n   - **Gold to Other Coins:**\n     - 1 Gold = 100 Copper\n     - 1 Gold = 10 Silver\n     - 1 Gold = 2 Electrum\n     - 10 Gold = 1 Platinum\n\n   - **Platinum to Other Coins:**\n     - 1 Platinum = 1,000 Copper\n     - 1 Platinum = 100 Silver\n     - 1 Platinum = 20 Electrum\n     - 1 Platinum = 10 Gold\n\n3. **Use These Rates to Make Exchanges:**\n   - Determine the starting coin type.\n   - Use the rates above to convert to the desired coin type.\n   - Calculate and provide change as needed according to these rates.",
    "/api/2014/rule-sections/objects": "### Step-by-Step Instructions for Handling Objects\n\n1. **Identify the Object**:\n   - Verify the object is distinct and inanimate (e.g., window, door).\n\n2. **Determine Destructibility**:\n   - Assume characters can destroy destructible objects with enough time and correct tools.\n\n3. **Use Common Sense**:\n   - Consider logical outcomes (e.g., a sword won't cut through stone).\n\n4. **Assign Armor Class (AC)**:\n   - Determine AC based on material:\n     - Cloth, paper, rope: AC 11\n     - Crystal, glass, ice: AC 13\n     - Wood, bone: AC 15\n     - Stone: AC 17\n     - Iron, steel: AC 19\n     - Mithral: AC 21\n     - Adamantine: AC 23\n\n5. **Assign Hit Points (HP)**:\n   - Determine size and resilience:\n     - Tiny (bottle, lock): Fragile 2 HP, Resilient 5 HP\n     - Small (chest, lute): Fragile 3 HP, Resilient 10 HP\n     - Medium (barrel, chandelier): Fragile 4 HP, Resilient 18 HP\n     - Large (cart, big window): Fragile 5 HP, Resilient 27 HP\n\n6. **Consider Huge and Gargantuan Objects**:\n   - Normal weapons may be ineffective.\n   - Track HP by sections if desired.\n\n7. **Assess Damage Types**:\n   - Objects are immune to poison and psychic damage.\n   - Assign vulnerabilities or resistances (e.g., paper vulnerable to fire).\n\n8. **Apply Damage Threshold (if applicable)**:\n   - Use for big objects (e.g., castle walls).\n   - Only damage meeting or exceeding the threshold affects object HP.",
    "/api/2014/rule-sections/poisons": "Step-by-step Instructions for Using Poisons in D&D 5e:\n\n### Types of Poisons:\n\n1. **Contact Poisons**\n   - Apply poison on an object.\n   - Remains effective until touched or washed off.\n   - Creature touching with exposed skin suffers effects.\n\n2. **Ingested Poisons**\n   - Creature must swallow a full dose for effects.\n   - Can be mixed in food or drink.\n   - Partial dose may have reduced effects.\n\n3. **Inhaled Poisons**\n   - Exists as powders or gases.\n   - Affects creatures in a 5-foot cube area.\n   - Holding breath does not prevent effects.\n\n4. **Injury Poisons**\n   - Apply to weapons or traps.\n   - Effective until delivered through a wound.\n   - Affects creatures taking piercing or slashing damage.\n\n### Poisons and Effects:\n\n- **Assassin's Blood**\n  - Type: Ingested\n  - DC: 10 Constitution Save\n  - Failed Save: 6 (1d12) poison damage, poisoned for 24 hours.\n  - Successful Save: Half damage, not poisoned.\n\n- **Burnt Othur Fumes**\n  - Type: Inhaled\n  - DC: 13 Constitution Save\n  - Failed Save: 10 (3d6) initial damage, repeat saves for 3 (1d6) damage.\n  - Ends after 3 successful saves.\n\n- **Crawler Mucus**\n  - Type: Contact\n  - DC: 13 Constitution Save\n  - Failed Save: Poisoned and paralyzed for 1 minute.\n  - Can repeat save at the end of turns.\n\n- **Drow Poison**\n  - Type: Injury\n  - DC: 13 Constitution Save\n  - Failed Save: Poisoned for 1 hour; fail by 5, unconscious.\n  - Wake up on damage or action to awaken.\n\n- **Essence of Ether**\n  - Type: Inhaled\n  - DC: 15 Constitution Save\n  - Failed Save: Poisoned, unconscious for 8 hours.\n  - Wake on damage or action to awaken.\n\n- **Malice**\n  - Type: Inhaled\n  - DC: 15 Constitution Save\n  - Failed Save: Poisoned, blinded for 1 hour.\n\n- **Midnight Tears**\n  - Type: Ingested\n  - DC: 17 Constitution Save\n  - Effect at midnight: 31 (9d6) damage on fail, half on success.\n\n- **Oil of Taggit**\n  - Type: Contact\n  - DC: 13 Constitution Save\n  - Failed Save: Poisoned, unconscious for 24 hours.\n  - Wake on damage.\n\n- **Pale Tincture**\n  - Type: Ingested\n  - DC: 16 Constitution Save\n  - Failed Save: 3 (1d6) damage, poisoned.\n  - Repeat save every 24 hours, poison damage un-healable until 7 successful saves.\n\n- **Purple Worm Poison**\n  - Type: Injury\n  - DC: 19 Constitution Save\n  - Failed Save: 42 (12d6) damage, half on success.\n\n- **Serpent Venom**\n  - Type: Injury\n  - DC: 11 Constitution Save\n  - Failed Save: 10 (3d6) damage, half on success.\n\n- **Torpor**\n  - Type: Ingested\n  - DC: 15 Constitution Save\n  - Failed Save: Poisoned, incapacitated for 4d6 hours.\n\n- **Truth Serum**\n  - Type: Ingested\n  - DC: 11 Constitution Save\n  - Failed Save: Poisoned, cannot lie for 1 hour.\n\n- **Wyvern Poison**\n  - Type: Injury\n  - DC: 15 Constitution Save\n  - Failed Save: 24 (7d6) damage, half on success.\n\nEnsure players make Constitution saving throws as specified. Apply effects based on save outcome.",
    "/api/2014/rule-sections/attunement": "### Attunement Instructions\n\n1. **Check Prerequisites:**\n   - Verify if the item requires a specific class or being a spellcaster.\n   - Ensure the creature meets these prerequisites.\n\n2. **Attune to the Item:**\n   - Spend a short rest focused solely on the item.\n   - Maintain physical contact with it.\n   - Perform an appropriate activity (e.g., weapon practice for weapons, meditation for wondrous items).\n\n3. **Avoid Interruptions:**\n   - Ensure the short rest is uninterrupted; otherwise, the attunement attempt fails.\n\n4. **Complete Attunement:**\n   - At the end of the short rest, gain understanding of the item's magical properties.\n\n5. **Manage Attuned Items:**\n   - A creature can attune to up to three magic items.\n   - Attuning to a fourth item fails; end attunement with one item first.\n   - Do not attune to more than one copy of an item.\n\n6. **End of Attunement:**\n   - Attunement ends if prerequisites are no longer met, the item is over 100 feet away for 24 hours, the creature dies, or another creature attunes to the item.\n   - Voluntarily end attunement by spending another short rest focused on the item (unless cursed).\n\n7. **Use Nonmagical Benefits:**\n   - Without attunement, only the item's nonmagical benefits apply.",
    "/api/2014/rule-sections/wearing-and-wielding-items": "### Wearing and Wielding Items\n\n1. **Determine Item Type:**\n   - Identify if the item is meant to be worn (e.g., boots, gloves, hat) or wielded (e.g., weapon).\n\n2. **Wearing Items:**\n   - Wear boots on feet.\n   - Wear gloves on hands.\n   - Wear hats or helmets on the head.\n   - Wear rings on fingers.\n   - Don magic armor appropriately.\n   - Strap shields to arms.\n   - Fasten cloaks around shoulders.\n\n3. **Wielding Items:**\n   - Hold weapons for use.\n\n4. **Size and Fit:**\n   - Assume items fit any creature unless the story specifies otherwise.\n   - Consider specific fit restrictions for narrative reasons (e.g., drow armor for elves).\n\n5. **Nonhumanoid Creatures:**\n   - Decide if items work based on the creature's anatomy.\n   - Example: Rings might work on tentacles but boots won't on serpentine tails.\n\n### Multiple Items of the Same Kind\n\n1. **Common Sense Limitations:**\n   - Limit to one of each type: footwear, gloves, bracers, armor, headwear, cloak.\n   - Consider exceptions with layered items (e.g., circlet under a helmet).\n\n### Paired Items\n\n1. **Paired Items Requirement:**\n   - Ensure both items of a pair are worn to gain benefits.\n   - Example: Both boots must be worn to gain their magical effects.",
    "/api/2014/rule-sections/activating-an-item": "**Activating a Magic Item**\n\n1. **Check Item Description:**\n   - Refer to the item’s specific description for activation details.\n\n2. **Determine Activation Requirement:**\n   - Identify if the item requires an action, command word, or any special requirement.\n\n3. **Command Word Activation:**\n   - Hold the item.\n   - Utter the specific command word.\n   - Note: Cannot activate in a sound-prevented area (e.g., under a silence spell).\n\n4. **Using Consumables:**\n   - Swallow a potion or elixir.\n   - Apply an oil to the body.\n   - Read and consume a scroll (text vanishes upon use).\n\n5. **Casting Spells from Items:**\n   - Cast at the lowest spell level.\n   - Does not use your spell slots.\n   - No components needed unless noted.\n   - Follow normal casting time, range, and duration.\n   - Concentrate if the spell requires it.\n   - If asked, use your spellcasting ability. If none, use +0 and add proficiency bonus.\n\n6. **Items with Charges:**\n   - Identify the number of charges through an identify spell or attunement.\n   - Use charges to activate item features.\n   - Attuned creatures learn regained charges after use.",
    "/api/2014/rule-sections/sentient-magic-items": "### Sentient Magic Items Guide\n\n#### Creating Sentient Magic Items\n\n1. **Choose or Determine Abilities:**\n   - Provide Intelligence, Wisdom, and Charisma scores.\n   - To determine randomly, roll 4d6 for each ability, drop the lowest roll, and total the rest.\n\n2. **Set Communication Method:**\n   - Choose or roll d100:\n     - 01-60: Transmits emotions.\n     - 61-90: Speaks, reads, and understands languages.\n     - 91-100: Speaks, reads, understands languages, plus telepathy with carrier.\n\n3. **Decide on Senses:**\n   - Choose or roll d4:\n     - 1: Hearing and normal vision, 30 feet.\n     - 2: Hearing and normal vision, 60 feet.\n     - 3: Hearing and normal vision, 120 feet.\n     - 4: Hearing and darkvision, 120 feet.\n\n4. **Determine Alignment:**\n   - Choose or roll d100:\n     - 01-15: Lawful good\n     - 16-35: Neutral good\n     - 36-50: Chaotic good\n     - 51-63: Lawful neutral\n     - 64-73: Neutral\n     - 74-85: Chaotic neutral\n     - 86-89: Lawful evil\n     - 90-96: Neutral evil\n     - 97-100: Chaotic evil\n\n5. **Establish Special Purpose:**\n   - Choose or roll d10:\n     - 1: Defeat opposed alignment\n     - 2: Defeat specific creature type\n     - 3: Defend specific race\n     - 4: Fight against a deity’s servants\n     - 5: Defend a deity’s interests\n     - 6: Crave destruction\n     - 7: Seek glory and renown\n     - 8: Seek knowledge/mystery\n     - 9: Role in future events\n     - 10: Find creator\n\n#### Managing Conflict\n\n1. **Monitor Alignment/Purpose Conflicts:**\n   - If a wielder’s actions oppose the item’s alignment/purpose, a conflict may arise.\n\n2. **Resolve Conflicts with Charisma Check:**\n   - The item and wielder make opposed Charisma checks.\n   - If the item wins, it can demand:\n     - Be carried or worn at all times.\n     - Dispose of repugnant items.\n     - Pursue its goals exclusively.\n     - Be given to someone else.\n\n3. **If Demands Are Refused:**\n   - The item may:\n     - Prevent attunement.\n     - Suppress properties.\n     - Attempt control.\n\n4. **Attempt to Control Wielder:**\n   - Wielder makes Charisma saving throw (DC 12 + item’s Charisma modifier).\n   - On failure, charmed for 1d12 hours.\n   - While charmed, follow item commands.\n   - Repeat saving throw if taking damage to end effect.\n   - Control attempt can’t be repeated until next dawn.",
    "/api/2014/rule-sections/fantasy-historical-pantheons": "### Fantasy-Historical Pantheons\n\n#### Celtic Pantheon\n\n1. Understand Celtic deities are linked to nature.\n2. Incorporate both druids and clerics to serve these gods.\n3. Familiarize with key deities:\n   - The Daghdha: Weather and crops, CG, Nature/Trickery, Symbol: Bubbling cauldron/shield.\n   - Arawn: Life and death, NE, Life/Death, Symbol: Black star on gray.\n   - Belenus: Sun and light, NG, Light, Symbol: Solar disk/standing stones.\n   - Brigantia: Rivers and livestock, NG, Life, Symbol: Footbridge.\n   - Diancecht: Medicine and healing, LG, Life, Symbol: Crossed oak/mistletoe.\n   - Dunatis: Mountains and peaks, N, Nature, Symbol: Red sun-capped peak.\n   - Goibhniu: Smiths and healing, NG, Knowledge/Life, Symbol: Mallet over sword.\n   - Lugh: Arts and travel, CN, Knowledge/Life, Symbol: Long hands.\n   - Manannan mac Lir: Oceans, LN, Nature/Tempest, Symbol: Wave on green.\n   - Math Mathonwy: Magic, NE, Knowledge, Symbol: Staff.\n   - Morrigan: Battle, CE, War, Symbol: Crossed spears.\n   - Nuada: War, N, War, Symbol: Silver hand on black.\n   - Oghma: Speech and writing, NG, Knowledge, Symbol: Unfurled scroll.\n   - Silvanus: Nature, N, Nature, Symbol: Summer oak tree.\n\n#### Greek Pantheon\n\n1. Recognize the Greek pantheon resides in nature.\n2. Learn key deities:\n   - Zeus: Sky and ruler, N, Tempest, Symbol: Fist with lightning.\n   - Aphrodite: Love, CG, Light, Symbol: Sea shell.\n   - Apollo: Light and music, CG, Knowledge/Life/Light, Symbol: Lyre.\n   - Ares: War, CE, War, Symbol: Spear.\n   - Artemis: Hunting and childbirth, NG, Life/Nature, Symbol: Bow on lunar disk.\n   - Athena: Wisdom, LG, Knowledge/War, Symbol: Owl.\n   - Demeter: Agriculture, NG, Life, Symbol: Mare's head.\n   - Dionysus: Mirth and wine, CN, Life, Symbol: Thyrsus.\n   - Hades: Underworld, LE, Death, Symbol: Black ram.\n   - Hecate: Magic, CE, Knowledge/Trickery, Symbol: Setting moon.\n   - Hephaestus: Smithing, NG, Knowledge, Symbol: Hammer/anvil.\n   - Hera: Marriage, CN, Trickery, Symbol: Peacock feathers.\n   - Hercules: Strength, CG, Tempest/War, Symbol: Lion's head.\n   - Hermes: Travel, CG, Trickery, Symbol: Caduceus.\n   - Hestia: Home, NG, Life, Symbol: Hearth.\n   - Nike: Victory, LN, War, Symbol: Winged woman.\n   - Pan: Nature, CN, Nature, Symbol: Pan pipes.\n   - Poseidon: Sea, CN, Tempest, Symbol: Trident.\n   - Tyche: Fortune, N, Trickery, Symbol: Red pentagram.\n\n#### Egyptian Pantheon\n\n1. Egyptian deities focus on cosmic order (Ma'at).\n2. Be mindful of three death gods with different alignments.\n3. Study key deities:\n   - Re-Horakhty: Sun, LG, Life/Light, Symbol: Solar disk/serpent.\n   - Anubis: Judgment and death, LN, Death, Symbol: Black jackal.\n   - Apep: Evil and fire, NE, Trickery, Symbol: Flaming snake.\n   - Bast: Cats and vengeance, CG, War, Symbol: Cat.\n   - Bes: Luck and music, CN, Trickery, Symbol: Misshapen deity.\n   - Hathor: Love and music, NG, Life/Light, Symbol: Cow's head with lunar disk.\n   - Imhotep: Crafts, NG, Knowledge, Symbol: Step pyramid.\n   - Isis: Fertility, NG, Knowledge/Life, Symbol: Ankh/star.\n   - Nephthys: Death, CG, Death, Symbol: Horns with lunar disk.\n   - Osiris: Nature, LG, Life/Nature, Symbol: Crook/flail.\n   - Ptah: Crafts, LN, Knowledge, Symbol: Bull.\n   - Set: Darkness, CE, Death/Tempest/Trickery, Symbol: Coiled cobra.\n   - Sobek: Water, LE, Nature/Tempest, Symbol: Crocodile head.\n   - Thoth: Knowledge, N, Knowledge, Symbol: Ibis.\n\n#### Norse Pantheon\n\n1. Note the Norse setting is harsh, requiring adaptability.\n2. Understand two main families: Aesir (war/destiny) and Vanir (fertility/prosperity).\n3. Review key deities:\n   - Odin: Knowledge and war, NG, Knowledge/War, Symbol: Blue eye.\n   - Aegir: Sea and storms, NE, Tempest, Symbol: Ocean waves.\n   - Balder: Beauty and poetry, NG, Life/Light, Symbol: Silver chalice.\n   - Forseti: Justice, N, Light, Symbol: Bearded man.\n   - Frey: Fertility, NG, Life/Light, Symbol: Greatsword.\n   - Freya: Love, NG, Life, Symbol: Falcon.\n   - Frigga: Birth, N, Life/Light, Symbol: Cat.\n   - Heimdall: Watchfulness, LG, Light/War, Symbol: Horn.\n   - Hel: Underworld, NE, Death, Symbol: Rotting face.\n   - Hermod: Luck, CN, Trickery, Symbol: Winged scroll.\n   - Loki: Trickery, CE, Trickery, Symbol: Flame.\n   - Njord: Sea, NG, Nature/Tempest, Symbol: Gold coin.\n   - Odur: Light, CG, Light, Symbol: Solar disk.\n   - Sif: War, CG, War, Symbol: Sword.\n   - Skadi: Earth, N, Nature, Symbol: Mountain peak.\n   - Surtur: Fire giants, LE, War, Symbol: Flaming sword.\n   - Thor: Storms, CG, Tempest/War, Symbol: Hammer.\n   - Thrym: Frost giants, CE, War, Symbol: Double-bladed axe.\n   - Tyr: Courage, LN, Knowledge/War, Symbol: Sword.\n   - Uller: Hunting, CN, Nature, Symbol: Longbow.",
    "/api/2014/rule-sections/the-planes-of-existence": "### Planes of Existence Instructions for a Rookie DM\n\n#### Understanding the Planes\n\n1. **Material Plane**: \n   - All campaigns and worlds you create exist here.\n   - It's diverse and reflects your creative world-building.\n\n2. **Beyond the Material**:\n   - There are other planes with different qualities.\n   - These are realms of myth, governed by distinct principles.\n\n#### Planar Travel\n\n1. **Travel Methods**:\n   - Use spells or portals to travel beyond the Material Plane.\n\n2. **Spells for Travel**:\n   - *Plane Shift*, *Gate*: Direct travel to other planes.\n   - *Etherealness*: Enter Ethereal Plane, access other planes.\n   - *Astral Projection*: Travel Astral Plane to Outer Planes.\n\n3. **Portals**:\n   - Stationary links between planes.\n   - May appear as doorways or specific locations.\n\n#### Transitive Planes\n\n1. **Ethereal Plane**:\n   - Foggy, overlaps Material and Inner Planes.\n   - Use *Etherealness* to enter, special vision needed.\n\n2. **Astral Plane**:\n   - Realm of thought and dreams.\n   - Use *Astral Projection* for travel.\n\n#### Inner Planes\n\n1. **Elemental Planes**:\n   - Air, Earth, Fire, Water; form a ring around the Material Plane.\n   - Known for pure elemental forms further from Material Plane.\n\n#### Outer Planes\n\n1. **Description**:\n   - Homes of deities, realms of thought and spirit.\n   - Familiar but can change with what's desired by the inhabitants.\n\n2. **Alignments**:\n   - **Upper Planes**: Good-aligned creatures.\n   - **Lower Planes**: Evil-aligned creatures.\n\n#### Demiplanes\n\n1. **Features**:\n   - Small, unique spaces with specific rules.\n   - Created by spells, deities, or naturally.\n\n2. **Access**:\n   - Entry through a connection point or by specific spells.\n   - *Gate* and *Plane Shift* spells may allow access.\n\n---\n\nUse these points as a guide for integrating other planes into your campaign. Adjust and expand as your story requires!",
    "/api/2014/rule-sections/traps": "# Trap Instructions for Dungeon Masters\n\n## What Are Traps?\nTraps can be mechanical or magical. They might damage, capture, or surprise adventurers.\n\n### Type of Traps\n- **Mechanical Traps**: Pits, arrow traps, falling blocks, etc.\n- **Magic Traps**: Includes magical devices or spells like *glyph of warding*.\n\n## Handling Traps in the Game\n\n### Triggering a Trap\n1. Identify how the trap is triggered (e.g., pressure plate, trip wire).\n2. For magic traps, it may trigger by entering an area or touching an object.\n\n### Detecting a Trap\n1. Inspect for uneven surfaces, wires, or holes.\n2. Roll Wisdom (Perception) check for detection.\n3. Compare trap's DC with characters' passive Wisdom (Perception).\n\n### Disabling a Trap\n1. For mechanical traps, use an Intelligence (Investigation) check, then a Dexterity check with thieves' tools.\n2. For magic traps, use an Intelligence (Arcana) check or *dispel magic*.\n3. Recognize that clever play may bypass the need for checks.\n\n### Effect of Traps\n1. Effects vary: damage, poison, fire, etc.\n2. Use Trap Save DCs and Attack Bonuses for severity:\n   - Setback (DC 10-11, Attack +3 to +5)\n   - Dangerous (DC 12-15, Attack +6 to +8)\n   - Deadly (DC 16-20, Attack +9 to +12)\n\n3. Use Damage Severity by Level table for damage output.\n\n### Complex Traps\n1. Complex traps act like combat encounters, activating in turns.\n2. Follow the trap's initiative and actions each round.\n\n## Sample Traps\n\n### Collapsing Roof\n1. Uses a trip wire between beams.\n2. DC 10 to spot, DC 15 Dexterity check with thieves' tools to disarm.\n3. Triggered collapse causes 4d10 bludgeoning damage.\n\n### Falling Net\n1. Uses a trip wire to drop a hidden net.\n2. DC 10 to spot, DC 15 Dexterity check with thieves' tools to disarm.\n3. Characters trapped and restrained, can break free with DC 10 Strength check.\n\n### Fire-Breathing Statue\n1. Pressure plate triggers a flame cone.\n2. DC 15 to detect, DC 13 Dexterity save against damage.\n3. Use *dispel magic* DC 13 on the statue to disable.\n\n### Pits\n- **Simple Pit**: DC 10 to spot, fall causes damage.\n- **Hidden Pit**: DC 15 Perception to spot, requires checks to open safely.\n- **Locking Pit**: Locks after triggering, requires DC 20 Strength to open.\n- **Spiked Pit**: Adds piercing and possibly poison damage.\n\n### Poison Darts\n1. Pressure plate triggers darts.\n2. DC 15 to detect, stuff holes to prevent darts firing.\n3. Includes attack and poison damage if triggered.\n\n### Poison Needle\n1. Triggered by lock tampering.\n2. DC 20 Investigation to detect, DC 15 Dexterity to disarm.\n\n### Rolling Sphere\n1. Pressure plate releases a rolling sphere.\n2. DC 15 to detect, sphere rolls on initiative.\n3. DC 15 Dexterity saving throw to avoid damage.\n\n### Sphere of Annihilation\n1. Magic trap in a carved face.\n2. DC 20 Arcana to detect.\n3. Any matter entering is destroyed.\n\nUse these steps to add depth and challenge to your game sessions!",
    "/api/2014/rule-sections/diseases": "## Diseases in Your Campaign\n\n### General Guidelines\n\n1. **Disease as a Plot Device**\n   - Use diseases to create quests and plot twists.\n   - Decide on the disease's impact on different creatures and races.\n\n2. **Customizing Diseases**\n   - Adjust disease characteristics (saving throw DCs, incubation times, symptoms) to fit your campaign.\n\n### Specific Diseases\n\n#### Cackle Fever\n\n1. **Infection and Immunity**\n   - Targets humanoids (gnomes are immune).\n   - Symptoms appear 1d4 hours after infection: fever and disorientation.\n   - The infected gain one level of exhaustion until cured.\n\n2. **Stress-Induced Effects**\n   - Stress triggers a DC 13 Constitution saving throw (combat, damage, fear, nightmares).\n   - On failure: 5 (1d10) psychic damage and 1 minute of incapacitation (mad laughter).\n   - Repeat save at the end of each turn to end effects.\n\n3. **Spread and Immunity**\n   - Within 10 feet of mad laughter: DC 10 Constitution saving throw to avoid infection.\n   - Success grants immunity to that laughter for 24 hours.\n\n4. **Recovery and Consequences**\n   - At each long rest: DC 13 Constitution saving throw.\n   - Successful save reduces future DC by 1d6.\n   - When DC reaches 0, the creature recovers.\n   - Failing three saves results in indefinite madness.\n\n#### Sewer Plague\n\n1. **Transmission and Symptoms**\n   - Contracted via bites or contact with contaminated areas.\n   - DC 11 Constitution saving throw to resist infection.\n   - Symptoms after 1d4 days: fatigue, cramps, one level of exhaustion.\n\n2. **Recovery Process**\n   - After each long rest: DC 11 Constitution saving throw.\n   - Failure: gain one level of exhaustion.\n   - Success: reduce exhaustion by one level.\n   - Recovery when exhaustion level drops below 1.\n\n#### Sight Rot\n\n1. **Infection and Symptoms**\n   - Contracted by drinking tainted water.\n   - DC 15 Constitution saving throw to resist infection.\n   - Symptoms start a day later: -1 penalty to sight-related rolls.\n\n2. **Symptom Development**\n   - Penalty worsens by 1 after each long rest.\n   - At -5, the victim is blinded until cured by magic.\n\n3. **Treatment**\n   - Cure with Eyebright flower (requires herbalism kit proficiency).\n   - One dose prevents worsening for a day.\n   - Three doses cure the disease completely.\n\nUse these guidelines to incorporate intriguing disease elements into your campaign, tailored for excitement and challenge.",
    "/api/2014/rule-sections/madness": "# Madness in D&D 5e\n\n## Going Mad\n\n1. **Identify Causes of Madness:**\n   - Magic (e.g., *contact other plane*, *symbol*).\n   - Diseases, poisons.\n   - Planar effects (psychic wind, Pandemonium).\n   - Artifacts.\n\n2. **Saving Throws:**\n   - Typically requires a Wisdom or Charisma saving throw.\n\n## Madness Effects\n\n### Short-Term Madness\n\n1. **Duration:**\n   - Roll 1d10 to determine minutes it lasts.\n   \n2. **Determine Effect:**\n   - Roll d100 and consult the Short-Term Madness table.\n\n### Long-Term Madness\n\n1. **Duration:**\n   - Roll 1d10, multiply by 10 for hours it lasts.\n   \n2. **Determine Effect:**\n   - Roll d100 and consult the Long-Term Madness table.\n\n### Indefinite Madness\n\n1. **Duration:**\n   - Lasts until cured.\n   \n2. **Determine Flaw:**\n   - Roll d100 and consult the Indefinite Madness table.\n\n## Short-Term Madness Table\n\n- 01-20: Paralyzed unless damaged.\n- 21-30: Incapacitated, screaming/laughing/crying.\n- 31-40: Frightened, must flee.\n- 41-50: Babbling, cannot speak/cast spells.\n- 51-60: Must attack nearest creature.\n- 61-70: Hallucinations, disadvantage on ability checks.\n- 71-75: Follows non-destructive orders.\n- 76-80: Eats unusual substances.\n- 81-90: Stunned.\n- 91-100: Unconscious.\n\n## Long-Term Madness Table\n\n- 01-10: Repeats specific activity.\n- 11-20: Hallucinations, disadvantage on ability checks.\n- 21-30: Paranoia, disadvantage on Wisdom/Charisma checks.\n- 31-40: Intense revulsion (antipathy effect).\n- 41-45: Believes under potion effects.\n- 46-55: Attached to a charm, disadvantage if distant.\n- 56-65: Blinded (25%) or deafened (75%).\n- 66-75: Tremors/tics, disadvantage on specific rolls.\n- 76-85: Partial amnesia.\n- 86-90: Must save vs. confusion when damaged.\n- 91-95: Loses ability to speak.\n- 96-100: Unconscious, cannot be woken.\n\n## Indefinite Madness Table\n\n- 01-15: Relies on alcohol.\n- 16-25: Keeps everything found.\n- 26-30: Imitates someone else.\n- 31-35: Lies to seem interesting.\n- 36-45: Obsessed with a goal.\n- 46-50: Apathetic.\n- 51-55: Feels judged.\n- 56-70: Overestimates own qualities.\n- 71-80: Believes in endless pursuit by enemies.\n- 81-85: Trusts one invisible friend.\n- 86-95: Finds serious situations funny.\n- 96-100: Enjoys killing.\n\n## Curing Madness\n\n1. **Suppression:**\n   - Use *calm emotions*.\n\n2. **Ridding Madness:**\n   - Use *lesser restoration* for short-term/long-term madness.\n   - Use *remove curse* or *dispel evil* if applicable.\n\n3. **Permanent Cure:**\n   - Use *greater restoration* or more powerful magic for indefinite madness.",
}


if __name__ == "__main__":
    # filename string
    ruleset = RuleSet.RULE_SECTIONS.value

    # Load the JSON file
    json_rule_path = data_folder / f"{ruleset}.json"
    with open(json_rule_path, "r") as file:
        data = json.load(file)

    # Normalize the JSON data to flatten it
    df = pd.json_normalize(data, sep="_")

    # Check if the JSON data has the expected schema
    assert set(df.columns.to_list()) == set(["name", "index", "desc", "url"]), (
        "Unexpected data organization, schema has probably changed"
    )

    # Dropping unnecessary columns
    df = df.drop([index_col_str], axis=1)

    # Join the rewritten content. If rewrite merge is OFF then just make a duplicate of the desc column
    if add_rewrite:
        df = pd.merge(
            df,
            pd.Series(rewrite_content)
            .reset_index()
            .rename(columns={0: "rule_section_as_instructions"}),
            left_on=url_col_str,
            right_on="index",
            how="left",
        ).drop(
            "index", axis=1
        )  # 'index' in this reference comes from pd.Series(rewrite_content).reset_index(). It's not the index column
        # from the original df, which is index_col_str
    else:
        df["rule_section_as_instructions"] = df[desc_col_str]

    # Check if the output data has the expected schema before saving
    assert set(df.columns.to_list()) == set(
        ["name", "desc", "url", "rule_section_as_instructions"]
    ), "Unexpected column names, schema has probably changed"

    # Save the table as a parquet file
    save_folder.mkdir(parents=True, exist_ok=True)
    df.to_parquet(save_folder / f"{ruleset}.parquet")
